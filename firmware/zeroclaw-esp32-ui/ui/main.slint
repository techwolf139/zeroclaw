export struct Message {
    role: string,
    content: string,
    timestamp: string,
}

export component StatusBar inherits Rectangle {
    in property <string> status;
    in property <bool> connected;
    in property <int> wifi-signal;
    
    callback clicked();
    
    background: #16213e;
    
    HorizontalLayout {
        padding-left: 8px;
        padding-right: 8px;
        spacing: 8px;
        alignment: space-between;
        
        Text {
            text: "ZeroClaw";
            color: #e94560;
            font-size: 14px;
            font-weight: 600;
            vertical-alignment: center;
        }
        
        HorizontalLayout {
            spacing: 6px;
            alignment: end;
            
            Rectangle {
                width: 16px;
                height: 12px;
                VerticalLayout {
                    spacing: 1px;
                    Rectangle { width: 4px; height: 2px; background: root.wifi-signal >= 1 ? #00d9ff : #333; }
                    Rectangle { width: 4px; height: 2px; background: root.wifi-signal >= 2 ? #00d9ff : #333; }
                    Rectangle { width: 4px; height: 2px; background: root.wifi-signal >= 3 ? #00d9ff : #333; }
                }
            }
            
            Rectangle {
                width: 8px;
                height: 8px;
                border-radius: 4px;
                background: root.connected ? #00d9ff : #ff4757;
            }
            
            TouchArea {
                width: 20px;
                height: 20px;
                clicked => { root.clicked(); }
                Text {
                    text: "[S]";
                    color: #666;
                    font-size: 12px;
                }
            }
        }
    }
}

export component MessageList inherits Rectangle {
    in property <[Message]> messages;
    
    background: #1a1a2e;
    
    VerticalLayout {
        spacing: 4px;
        padding: 8px;
        
        for msg in root.messages: HorizontalLayout {
            alignment: msg.role == "user" ? end : start;
            
            Rectangle {
                min-width: 100px;
                max-width: 240px;
                min-height: 36px;
                max-height: 60px;
                background: msg.role == "user" ? #0f3460 : #16213e;
                border-radius: 8px;
                padding: 6px;
                
                Text {
                    text: msg.content;
                    color: #eaeaea;
                    font-size: 11px;
                    wrap: word-wrap;
                }
            }
        }
    }
}

export component InputBar inherits Rectangle {
    in-out property <string> text;
    
    callback on-send(string);
    
    background: #16213e;
    
    HorizontalLayout {
        padding: 4px;
        spacing: 6px;
        
        input := TextInput {
            text <=> root.text;
            font-size: 12px;
            height: 24px;
            accepted => {
                if root.text != "" {
                    root.on-send(root.text);
                    root.text = "";
                }
            }
        }
        
        TouchArea {
            width: 44px;
            height: 24px;
            clicked => {
                if input.text != "" {
                    root.on-send(input.text);
                    root.text = "";
                }
            }
            Rectangle {
                background: #e94560;
                border-radius: 4px;
                Text {
                    text: "Send";
                    color: white;
                    font-size: 10px;
                }
            }
        }
    }
}

export component MenuOverlay inherits Rectangle {
    callback close();
    callback reconnect();
    callback disconnect();
    
    in property <string> server-url;
    
    background: #000000aa;
    
    Rectangle {
        width: 280px;
        height: 200px;
        background: #1a1a2e;
        border-radius: 8px;
        border-width: 1px;
        border-color: #333;
        
        VerticalLayout {
            spacing: 0px;
            
            Rectangle {
                height: 28px;
                background: #16213e;
                HorizontalLayout {
                    padding: 4px;
                    alignment: space-between;
                    Text {
                        text: "[S] Settings";
                        color: #eaeaea;
                        font-size: 12px;
                    }
                    TouchArea {
                        width: 20px;
                        clicked => { root.close(); }
                        Text {
                            text: "[X]";
                            color: #e94560;
                            font-size: 12px;
                        }
                    }
                }
            }
            
            Rectangle {
                height: 80px;
                VerticalLayout {
                    spacing: 4px;
                    padding: 8px;
                    Text {
                        text: "Connection";
                        color: #666;
                        font-size: 10px;
                    }
                    Text {
                        text: "Server: " + root.server-url;
                        color: #eaeaea;
                        font-size: 11px;
                    }
                    TouchArea {
                        height: 20px;
                        clicked => { root.reconnect(); }
                        Text {
                            text: "[C] Reconnect";
                            color: #00d9ff;
                            font-size: 11px;
                        }
                    }
                    TouchArea {
                        height: 20px;
                        clicked => { root.disconnect(); }
                        Text {
                            text: "[D] Disconnect";
                            color: #ff4757;
                            font-size: 11px;
                        }
                    }
                }
            }
            
            Rectangle {
                height: 60px;
                VerticalLayout {
                    spacing: 4px;
                    padding: 8px;
                    Text {
                        text: "About";
                        color: #666;
                        font-size: 10px;
                    }
                    Text {
                        text: "v0.1.0 | ZeroClaw ESP32";
                        color: #eaeaea;
                        font-size: 11px;
                    }
                    Text {
                        text: "320x240 ST7789 Display";
                        color: #666;
                        font-size: 10px;
                    }
                }
            }
        }
    }
}

export component QuickActionBar inherits Rectangle {
    callback clicked-memory();
    callback clicked-files();
    callback clicked-browser();
    callback clicked-settings();
    
    background: #16213e;
    
    HorizontalLayout {
        padding: 2px;
        spacing: 4px;
        alignment: space-around;
        
        TouchArea {
            width: 70px;
            height: 20px;
            clicked => { root.clicked-memory(); }
            Rectangle {
                background: #0f3460;
                border-radius: 4px;
                Text {
                    text: "Memory";
                    color: #00d9ff;
                    font-size: 10px;
                }
            }
        }
        
        TouchArea {
            width: 70px;
            height: 20px;
            clicked => { root.clicked-files(); }
            Rectangle {
                background: #0f3460;
                border-radius: 4px;
                Text {
                    text: "Files";
                    color: #00d9ff;
                    font-size: 10px;
                }
            }
        }
        
        TouchArea {
            width: 70px;
            height: 20px;
            clicked => { root.clicked-browser(); }
            Rectangle {
                background: #0f3460;
                border-radius: 4px;
                Text {
                    text: "Browser";
                    color: #00d9ff;
                    font-size: 10px;
                }
            }
        }
        
        TouchArea {
            width: 70px;
            height: 20px;
            clicked => { root.clicked-settings(); }
            Rectangle {
                background: #0f3460;
                border-radius: 4px;
                Text {
                    text: "Settings";
                    color: #00d9ff;
                    font-size: 10px;
                }
            }
        }
    }
}

export component MemoryOverlay inherits Rectangle {
    callback close();
    
    background: #1a1a2e;
    
    VerticalLayout {
        spacing: 0px;
        
        Rectangle {
            height: 28px;
            background: #16213e;
            HorizontalLayout {
                padding: 4px;
                spacing: 8px;
                TouchArea {
                    width: 30px;
                    clicked => { root.close(); }
                    Text {
                        text: "[<]";
                        color: #00d9ff;
                        font-size: 12px;
                    }
                }
                Text {
                    text: "Memory";
                    color: #eaeaea;
                    font-size: 14px;
                }
            }
        }
        
        VerticalLayout {
            spacing: 4px;
            padding: 8px;
            
            for i in 3: Rectangle {
                min-height: 50px;
                background: #16213e;
                border-radius: 4px;
                padding: 6px;
                VerticalLayout {
                    Text {
                        text: "Memory Entry " + (i + 1);
                        color: #00d9ff;
                        font-size: 11px;
                    }
                    Text {
                        text: "Preview text...";
                        color: #888;
                        font-size: 10px;
                    }
                }
            }
        }
    }
}

export component FilesOverlay inherits Rectangle {
    callback close();
    
    background: #1a1a2e;
    
    VerticalLayout {
        spacing: 0px;
        
        Rectangle {
            height: 28px;
            background: #16213e;
            HorizontalLayout {
                padding: 4px;
                spacing: 8px;
                TouchArea {
                    width: 30px;
                    clicked => { root.close(); }
                    Text {
                        text: "[<]";
                        color: #00d9ff;
                        font-size: 12px;
                    }
                }
                Text {
                    text: "Files";
                    color: #eaeaea;
                    font-size: 14px;
                }
            }
        }
        
        VerticalLayout {
            spacing: 4px;
            padding: 8px;
            
            for f in ["main.rs", "ui.slint", "Cargo.toml"]: Rectangle {
                min-height: 30px;
                background: #16213e;
                border-radius: 4px;
                padding: 6px;
                HorizontalLayout {
                    spacing: 8px;
                    Text {
                        text: "[F]";
                        color: #e94560;
                        font-size: 10px;
                    }
                    Text {
                        text: f;
                        color: #eaeaea;
                        font-size: 11px;
                    }
                }
            }
        }
    }
}

export component BrowserOverlay inherits Rectangle {
    callback close();
    
    background: #1a1a2e;
    
    VerticalLayout {
        spacing: 0px;
        
        Rectangle {
            height: 28px;
            background: #16213e;
            HorizontalLayout {
                padding: 4px;
                spacing: 8px;
                TouchArea {
                    width: 30px;
                    clicked => { root.close(); }
                    Text {
                        text: "[<]";
                        color: #00d9ff;
                        font-size: 12px;
                    }
                }
                Text {
                    text: "Browser";
                    color: #eaeaea;
                    font-size: 14px;
                }
            }
        }
        
        VerticalLayout {
            spacing: 4px;
            padding: 8px;
            
            Text {
                text: "Recent URLs";
                color: #666;
                font-size: 10px;
            }
            
            for url in ["google.com", "github.com", "rust-lang.org"]: Rectangle {
                min-height: 24px;
                background: #16213e;
                border-radius: 4px;
                padding: 4px;
                HorizontalLayout {
                    spacing: 8px;
                    Text {
                        text: "[>]";
                        color: #00d9ff;
                        font-size: 10px;
                    }
                    Text {
                        text: url;
                        color: #eaeaea;
                        font-size: 11px;
                    }
                }
            }
        }
        
        Rectangle {
            height: 32px;
            background: #16213e;
            HorizontalLayout {
                padding: 4px;
                spacing: 4px;
                TextInput {
                    text: "";
                    font-size: 11px;
                }
            }
        }
    }
}

export component MainWindow inherits Window {
    width: 320px;
    height: 240px;
    background: #1a1a2e;
    
    in property <string> status-text: "Ready";
    in property <bool> is-connected: false;
    in property <bool> show-menu: false;
    in property <bool> show-memory: false;
    in property <bool> show-files: false;
    in property <bool> show-browser: false;
    in property <int> wifi-signal: 0;
    in property <string> server-url: "http://192.168.1.100:8080";
    
    in property <[Message]> messages: [];
    in-out property <string> input-text: "";
    
    callback send-message(string);
    callback open-menu();
    callback open-memory();
    callback open-files();
    callback open-browser();
    callback close-menu();
    callback close-memory();
    callback close-files();
    callback close-browser();
    callback reconnect();
    callback disconnect-wifi();
    
    VerticalLayout {
        spacing: 0px;
        
        StatusBar {
            status: root.status-text;
            connected: root.is-connected;
            wifi-signal: root.wifi-signal;
            height: 28px;
            clicked => { root.open-menu(); }
        }
        
        MessageList {
            messages: root.messages;
            height: 150px;
        }
        
        QuickActionBar {
            clicked-memory => { root.open-memory(); }
            clicked-files => { root.open-files(); }
            clicked-browser => { root.open-browser(); }
            clicked-settings => { root.open-menu(); }
            height: 24px;
        }
        
        InputBar {
            text: input-text;
            on-send(text) => { root.send-message(text); }
            height: 32px;
        }
    }
    
    if root.show-menu: MenuOverlay {
        close => { root.close-menu(); }
        server-url: root.server-url;
        reconnect => { root.reconnect(); }
        disconnect => { root.disconnect-wifi(); }
    }
    
    if root.show-memory: MemoryOverlay {
        close => { root.close-memory(); }
    }
    
    if root.show-files: FilesOverlay {
        close => { root.close-files(); }
    }
    
    if root.show-browser: BrowserOverlay {
        close => { root.close-browser(); }
    }
}
